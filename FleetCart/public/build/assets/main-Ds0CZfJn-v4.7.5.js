import{g as n}from"./functions-CwRdlv5O-v4.7.5.js";import{S as o,N as l}from"./swiper-C8ZQRgZ4-v4.7.5.js";import{n as u}from"./nouislider--DU6hECO-v4.7.5.js";import"./ProductCard-BzXt53Qu-v4.7.5.js";import"./Pagination-DKj6Zlmg-v4.7.5.js";import"./ProductMixin-D4Z8_OKx-v4.7.5.js";import"./ProductRating-B-YFAG_Q-v4.7.5.js";Alpine.data("CustomFilterSelect",()=>({open:!1,selected:FleetCart.data.initialSort||"latest",values:{},get activeClass(){return this.open?"active":""},get selectedValueText(){return this.values[this.selected]},init(){this.setValues(),$(this.$el).find(`li.dropdown-item[data-value="${this.selected}"]`).addClass("active")},toggleOpen(){this.open=!this.open},hideDropdown(){this.open=!1},setValues(){const t={};$(this.$el).find("li").each(function(){t[$(this).attr("data-value")]=$(this).text().trim()}),this.values=t},changeValue(t){const e=t.currentTarget.getAttribute("data-value");$(this.$el).siblings().removeClass("active"),$(this.$el).addClass("active"),this.open=!1,this.selected!==e&&this.changeSort(e),this.selected=e}}));Alpine.data("CustomPageSelect",()=>({open:!1,selected:FleetCart.data.initialPerPage||20,get activeClass(){return this.open?"active":""},init(){$(this.$el).find(`li.dropdown-item[data-value="${this.selected}"]`).addClass("active")},toggleOpen(){this.open=!this.open},hideDropdown(){this.open=!1},changeValue(t){const e=t.currentTarget.getAttribute("data-value");$(this.$el).siblings().removeClass("active"),$(this.$el).addClass("active"),this.open=!1,this.selected!==e&&this.changePerPage(e),this.selected=e}}));const{initialQuery:c,initialBrandName:h,initialBrandBanner:d,initialBrandSlug:g,initialCategoryName:p,initialCategoryBanner:P,initialCategorySlug:m,initialTagName:f,initialTagSlug:y,initialAttribute:b,minPrice:r,maxPrice:a,initialSort:v,initialPage:s,initialPerPage:w,initialViewMode:q}=FleetCart.data;Alpine.data("ProductIndex",()=>({fetchingProducts:!1,products:{data:[]},attributeFilters:[],initialBrandName:h,initialTagName:f,brandBanner:d,categoryName:p,categoryBanner:P,viewMode:q,currentPage:s,queryParams:{query:c,brand:g,category:m,tag:y,attribute:b,fromPrice:0,toPrice:a,sort:v,perPage:w,page:s},get emptyProducts(){return this.products.data.length===0},get totalPage(){return Math.ceil(this.products.total/this.queryParams.perPage)},get showingResults(){if(!this.emptyProducts)return trans("storefront::products.showing_results",{from:this.products.from,to:this.products.to,total:this.products.total})},init(){this.initPriceFilter(),this.fetchProducts(),this.initLatestProductsSlider()},uid(){return n()},changeSort(t){this.queryParams.sort=t,this.fetchProducts()},changePerPage(t){this.currentPage=1,this.queryParams.perPage=t,this.queryParams.page=1,this.fetchProducts()},initPriceFilter(){u.create(this.$refs.priceRange,{connect:!0,direction:window.FleetCart.rtl?"rtl":"ltr",start:[r,a],range:{min:[r],max:[a]}}),this.$refs.priceRange.noUiSlider.on("update",(t,e)=>{const i=Number(t[e]);e===0?this.queryParams.fromPrice=i:this.queryParams.toPrice=i}),this.$refs.priceRange.noUiSlider.on("change",()=>{this.fetchProducts()})},updatePriceRange(t,e){this.$refs.priceRange.noUiSlider.set([t,e]),this.fetchProducts()},toggleAttributeFilter(t,e){this.queryParams.attribute.hasOwnProperty(t)||(this.queryParams.attribute[t]=[]),this.queryParams.attribute[t].includes(e)?this.queryParams.attribute[t].splice(this.queryParams.attribute[t].indexOf(e),1):this.queryParams.attribute[t].push(e),this.fetchProducts({updateAttributeFilters:!1})},isFilteredByAttribute(t,e){return this.queryParams.attribute.hasOwnProperty(t)?this.queryParams.attribute[t].includes(e):!1},changeCategory(t){const e=new URL(window.location.href),i=this.queryParams.category;if(this.categoryName=t.name,this.categoryBanner=t.banner.path,this.currentPage=1,this.queryParams.query=null,this.queryParams.category=t.slug,this.queryParams.attribute={},this.queryParams.page=1,this.fetchProducts(),e.pathname.includes(`/categories/${i}/products`)){e.pathname=e.pathname.replace(i,t.slug),window.history.replaceState(null,"",e.toString());return}e.searchParams.set("category",t.slug),window.history.replaceState({},"",e)},changePage(t){this.currentPage=t,this.queryParams.page=t,this.fetchProducts()},async fetchProducts(t={updateAttributeFilters:!0}){this.fetchingProducts=!0;try{const e=await axios.get("/products",{params:{...this.queryParams}});this.products=e.data.products,t.updateAttributeFilters&&(this.attributeFilters=e.data.attributes)}catch(e){notify(e.response.data.message)}finally{this.fetchingProducts=!1}},initLatestProductsSlider(){new o(this.$refs.latestProducts,{modules:[l],slidesPerView:1,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}})}}));
