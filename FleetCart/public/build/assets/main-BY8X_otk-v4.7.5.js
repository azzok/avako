import{E as d}from"./Errors-C30A2Jtx-v4.7.5.js";Alpine.data("Addresses",({initialAddresses:e,initialDefaultAddress:i,countries:a})=>({addresses:e,defaultAddress:i,countries:a,formOpen:!1,editing:!1,loading:!1,form:{state:""},states:{},errors:new d,get firstCountry(){return Object.keys(this.countries)[0]},get hasAddress(){return Object.keys(this.addresses).length!==0},get hasNoStates(){return Object.keys(this.states).length===0},init(){this.changeCountry(this.firstCountry)},changeDefaultAddress(s){this.defaultAddress.address_id!==s.id&&(this.defaultAddress.address_id=s.id,axios.post("/account/addresses/change-default",{address_id:s.id}).then(t=>{notify(t.data)}).catch(t=>{notify(t.response.data.message)}))},changeCountry(s){this.form.country=s,this.form.state="",this.fetchStates(s)},async fetchStates(s,t){const r=await axios.get(`/countries/${s}/states`);this.states=r.data,t&&t()},edit(s){this.formOpen=!0,this.editing=!0,this.$nextTick(()=>{this.form={...s},this.fetchStates(s.country,()=>{this.form.state="",this.$nextTick(()=>{this.form.state=s.state})})})},remove(s){confirm(trans("storefront::account.addresses.confirm"))&&axios.delete(`/account/addresses/${s.id}`).then(t=>{delete this.addresses[s.id],notify(t.data.message)}).catch(t=>{notify(t.response.data.message)})},cancel(){this.editing=!1,this.formOpen=!1,this.errors.reset(),this.resetForm()},save(){this.loading=!0,this.editing?this.update():this.create()},update(){axios.put(`/account/addresses/${this.form.id}`,this.form).then(({data:s})=>{this.formOpen=!1,this.editing=!1,this.addresses[this.form.id]=s.address,this.resetForm(),notify(s.message)}).catch(({response:s})=>{s.status===422&&this.errors.record(s.data.errors),notify(s.data.message)}).finally(()=>{this.loading=!1})},create(){axios.post("/account/addresses",this.form).then(({data:s})=>{this.formOpen=!1;let t={[s.address.id]:s.address};this.addresses={...this.addresses,...t},this.resetForm(),notify(s.message)}).catch(({response:s})=>{s.status===422&&this.errors.record(s.data.errors),notify(s.data.message)}).finally(()=>{this.loading=!1})},resetForm(){this.form={state:""}}}));
